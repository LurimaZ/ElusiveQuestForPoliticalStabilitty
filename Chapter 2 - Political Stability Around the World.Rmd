---
title: "Chapter 2 - Political Stability Around the World Since the End of the Cold War: Descriptive Statistics and Exploratory Data Analysis"
author: "Adrien Ratsimbaharison"
date: "10/14/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Outline:

2.1 - Descriptive Statistics

2.2 - Exploratory Data Analysis


## 2.1 - Descriptive Statistics

**General Stability of the World Since the End of the Cold War**

Generally, speaking the world as a whole was not stable since the end of the Cold War.

As shown in Table 1 and Figure 1 below, the summary statistics of political stability during the time period of 1996-2016 around the world produces an average of -0.0199 with standard deviation of 1.00, which seems to indicate that the whole world has been slightly unstable during this time period. One can also notice that whereas the maximum value of political stability is 1.96, the minimum value is -3.31. This minimum value seems abnormal, since the scale used by Kaufmann and his associates was -2.5 to 2.5.[^14] But this does not seem to affect our data analysis.   

Furthermore, Figure 2 shows that the data on political stability is not normally distributed, but skweed to the left, which indicates the existence of outliers with negative values. Figure 2 also shows that the mode is between 0.5 and 1.   


```{r echo=TRUE, warning=FALSE, include=TRUE}

# Table 1 - Summary statistics

summary(WGIbyRegion$stability, na.rm = TRUE)

```


```{r echo=FALSE, warning=FALSE, include=TRUE, fig.cap="Fig. 1 - Political Stability: Summary Statistics"}

#Figure 1 - Political Stability: Summary Statistics

boxplot(WGIbyRegion$stability, main = "")

```


```{r echo=FALSE, warning=FALSE, include=TRUE, fig.cap= "Figure 2 - Political Stability: Frequency"}

#Figure 2 - Political Stability: Frequency

hist(WGIbyRegion$stability, main= "", xlab = "Political Stability Estimate")
abline(v = median(WGIbyRegion$stability, na.rm = TRUE), lwd = 2)
text(x = -1, y = 650, "Median= 0.089")

```




**Political Stability Trend: Annual Average Around the World**  

As shown in Table 2 and Figure 3, the annual average of politial stability has remained below zero during the time period of 1996-2016 throughout the world. There was no time it had a positive value.

```{r echo=FALSE, warning=FALSE, include=FALSE}

# Political Stability Trend: Annual Average Around the World
PoliticalStabilityTrendWorld <- WGIbyRegion %>%
  group_by(date) %>%
  summarise(AnnualAverage = mean(stability, na.rm=TRUE))
PoliticalStabilityTrendWorld <- tbl_df(PoliticalStabilityTrendWorld)


```


```{r echo=FALSE, warning=FALSE, include=TRUE, results= 'asis'}

#Table 2 - Political Stability Trend: Annual Average Around the World

kable(PoliticalStabilityTrendWorld, caption = "Table 2 - Political Stability Trend: Annual Average Around the World")

```




```{r echo=FALSE, warning=FALSE, include=TRUE, fig.cap="Fig. 3 - Political Stability Trend: Annual Average Around the World"}


PoliticalStabilityTrendWorld$PSAnnualAverage <- as.numeric(PoliticalStabilityTrendWorld$AnnualAverage)

plot(PoliticalStabilityTrendWorld$date, PoliticalStabilityTrendWorld$AnnualAverage, type="o", lwd = 2,
     ylim=range( -1:1),
     main="",
     xlab = "Years", ylab = "Political Stability (Annual Average)")
abline(h = 0, lwd = 1.5)


```




**Political Stability: Average by Region** 

Table 3 and Figure 4 clearly show that the regions of Africa and Asia, with respectively an average of -0.575 and -0.388, were the two most unstable regions in the world during the time period of 1996-2016. On the contrary, the regions of Oceania and Europe, with respectively an average of 0.820 and 0.651, were the two most unstable regions in the world

```{r echo=FALSE, warning=FALSE, include=FALSE}

#Political Stability summary for each region

politicalStabilityByRegion <- summarise(group_by(WGIbyRegion, region),
          mean=mean(stability, na.rm = TRUE), sd=sd(stability, na.rm = TRUE))

```


```{r echo=FALSE, warning=FALSE, include=TRUE, results= "asis"}

#Table 3 - Political Stability: Average by Region

kable(politicalStabilityByRegion, caption = "Table 3 - Political Stability: Average by Region")


```


```{r echo=FALSE, warning=FALSE, include=TRUE, fig.cap="Fig. 4 - Political Stability: Average by Region"}

# Boxplot of Political Stability by Region
boxplot(stability~region,data=WGIbyRegion, main="",
        xlab="Regions", ylab="Political Stability Estimate")
abline(h = 0, lwd = 2)

```

## 2.2 - Exploratory Data Analysis

*Correlation Between Political Stability and the other World Governance Indicators (WGI)*

In this section, we plot political stability against the other world governance indicators (corruption control, government effectiveness, regulatory quality, rule of law, and voice and accountability), and find that political stability is strongly and significantly correlated with these other world governance indicators. The correlation coefficients range from 0.63 to 0.77, with a p-value close to zero.   

This result allows us to include all world governance indicators in our prediction models.


```{r echo=FALSE, warning=FALSE, include=TRUE, fig.cap="Fig. 5 - Correlation between Political Stability and the other World Governance Indicators (WGI)"}

# Scatterplot Matrix
pairs(~ stability + ruleOfLaw + governmentEffectiveness + corruptionControl + regulatoryQuality +  voiceAndAccountability,data=WGI,
   main="")

```



```{r echo=FALSE, warning=FALSE, include=FALSE}
# Correlation between Political Stability and the other World Governance Indicators (WGI)
WGI2 <- select(WGI, stability, corruptionControl, governmentEffectiveness, regulatoryQuality, ruleOfLaw,              voiceAndAccountability)
correlationWGI2 <- rcorr(as.matrix(WGI2))


```


```{r echo=TRUE, warning=FALSE, include=TRUE}

#Table 4 - Correlation Matrix between Political Stability and the other World Governance Indicators (WGI)

correlationWGI2


```


### *Correlation Between Political Stability, Development, and Social Inequality*

In this section, we plot political stability against the indicators of socioeconomic development (GNI per capita and Human Development Index (HDI)) and social inequality (GINI index), and find that while the correlation between political stability and GNI per capita is relatively strong (0.61), those between political stability, on the one hand, and HID and GNI, on the other hand, are moderate (respectively 0.48 and -0.34).   

Nevertheless, since all of these correlations are statistically significant (with p-values close to zero), we can still include these indicators of socioeconomic developmentin and social inequality in our prediction models.

```{r echo=FALSE, warning=FALSE, include=FALSE}

#data on GNI per capita (constant 2010 US$) (NY.GNP.PCAP.KD)
GNIperCapitaDf <- wb(country = "countries_only", indicator = "NY.GNP.PCAP.KD", 
                     startdate = 1996, enddate = 2017, POSIXct = TRUE)
GNIperCapitaDf <- tbl_df(GNIperCapitaDf)
GNIperCapitaDf <- select(GNIperCapitaDf, country, iso2c, date, value)
GNIperCapitaDf <- rename(GNIperCapitaDf, GNIperCapita = value)
head(GNIperCapitaDf)

#data on human development index (UNDP.HDI.XD)
HDIDf <- wb(country = "countries_only", indicator = "UNDP.HDI.XD", 
            startdate = 1996, enddate = 2017, POSIXct = TRUE)
HDIDf <- tbl_df(HDIDf)
HDIDf <- select(HDIDf, country, iso2c, date, value)
HDIDf <- rename(HDIDf, HDI = value)
head(HDIDf)

#data on social inequality measured in terms of the World Bank's GINI index (SI.POV.GINI)
GINIDf <- wb(country = "countries_only", indicator = "SI.POV.GINI", 
            startdate = 1996, enddate = 2017, POSIXct = TRUE)
GINIDf <- tbl_df(GINIDf)
GINIDf <- select(GINIDf, country, iso2c, date, value)
GINIDf <- rename(GINIDf, GINI = value)
head(GINIDf)

# joining the data on political stability and data on development and social inequality 
# (devIneqStab)
devIneqStabDf <- full_join(stabilityDf, GNIperCapitaDf, by = c("country", "iso2c", "date")) %>%
  full_join(., HDIDf, by = c("country", "iso2c", "date")) %>%
  full_join(., GINIDf, by = c("country", "iso2c", "date")) 
devIneqStabDf <- tbl_df(devIneqStabDf)
head(devIneqStabDf)
names(devIneqStabDf)

```

```{r echo=FALSE, warning=FALSE, include=TRUE, fig.cap="Fig. 6 - Correlation between Political Stability, Development, and Social Inequality"}
# Scatterplot Matrix of Political Stability, Development, and Social Inequality
pairs(~ stability + GNIperCapita + HDI + GINI, data=devIneqStabDf,
   main=" ")

```


```{r echo=FALSE, warning=FALSE, include=FALSE}
# Correlation Matrix between Political Stability and the Indicators of Development and Social Inequality
devIneqAndStab2 <- select(devIneqStabDf, stability, GNIperCapita, HDI, GINI)
correlationDevIneqStab2 <- rcorr(as.matrix(devIneqAndStab2))


```


```{r echo=TRUE, warning=FALSE, include=TRUE}

#Table 5 - Correlation Matrix between Political Stability and the Indicators of Development and Social Inequality

correlationDevIneqStab2


```


### *Correlation Between Political Instability and Regime Type Indicators*

In this section, we plot political stability against the indicators of regime type (Polity IV revised combined polity score, Polity IV score on institutionalized democracy, Polity IV score on institutionalized autocracy, Freedom House inversed score on political rights, Freedom House inversed score on civil liberties, Freedom House combined score), and find that while the correlation between political stability and GNI per capita is relatively strong (0.61), those between political stability, on the one hand, and HID and GNI, on the other hand, are moderate (respectively 0.48 and -0.34).   

Nevertheless, since all of these correlations are statistically significant (with p-values close to zero), we can still include these indicators of socioeconomic developmentin and social inequality in our prediction models.

```{r echo=FALSE, warning=FALSE, include=FALSE}

#data on political system, revised combined polity score (UPP.REV.POL.XQ) - see Polity IV
polityScoreDf <- wb(country = "countries_only", indicator = "UPP.REV.POL.XQ", 
                    startdate = 1996, enddate = 2017, POSIXct = TRUE)
polityScoreDf <- select(polityScoreDf, country, iso2c, date, value)
polityScoreDf <- rename(polityScoreDf, polityScore = value)
head(polityScoreDf)

# creating a new variable for polity category (polityCategory)
polityScoreDf <- polityScoreDf %>% mutate(polityCategory=cut(polityScore, breaks=c(-Inf, -6, 6, Inf), labels=c("Autocracy","Anocracy","Democracy")))
head(polityScoreDf)

#data on political system, Institutionalized democracy (UPP.INS.DEMO.XQ) - see Polity IV
democracyDf <- wb(indicator = "UPP.INS.DEMO.XQ", startdate = 1996, enddate = 2017, POSIXct = TRUE)
democracyDf <- select(democracyDf, country, iso2c, date, value)
democracyDf <- rename(democracyDf, democracyInst = value)
head(democracyDf)

#data on political system, Institutionalized autocracy (UPP.INS.AUTO.XQ) - see Polity IV
autocracyDf <- wb(country = "countries_only", indicator = "UPP.INS.AUTO.XQ", 
                  startdate = 1996, enddate = 2017, POSIXct = TRUE)
autocracyDf <- select(autocracyDf, country, iso2c, date, value)
autocracyDf <- rename(autocracyDf, autocracyInst = value)
head(autocracyDf)

# downloadong the data on political right and civil liberty from Freedom house from the website of
#Amanda B. Edgell, University of Florida
library(readxl)
url <- "https://acrowinghen.files.wordpress.com/2014/03/fh1972_20162.xlsx"
destfile <- "fh1972_20162.xlsx"
curl::curl_download(url, destfile)
FHdf <- read_xlsx(destfile)
FHdf <- tbl_df(FHdf)
FHdf <- select(FHdf, country, year, pr, cl, mean, status, inverse_pr, inverse_cl, inverse_mean)
FHdf <- filter(FHdf, year>= 1996)
FHdf <- rename(FHdf, date = year)
FHdf$date <- as.character(FHdf$date)
head(FHdf)

#merging the data on political right and civil liberty with the data on region and subregion with iso2c
FHDfByRegion <- merge(FHdf, regionSubregionDf, by = "country")
FHDfByRegion <- tbl_df(FHDfByRegion)
FHDfByRegion <- select(FHDfByRegion, country, iso2c, date, politicalRights = inverse_pr, 
                       civilLiberties = inverse_cl, FHcombinedScore = inverse_mean, FHstatus = status, 
                       region, subregion)
head(FHDfByRegion)
str(FHDfByRegion)

#joining the data on political stability and regime types indicators (regimeTypeDf)
regimeTypeDf <- full_join(stabilityDf, polityScoreDf, by = c("country", "iso2c", "date")) %>%
  full_join(., democracyDf, by = c("country", "iso2c", "date")) %>%
  full_join(., autocracyDf, by = c("country", "iso2c", "date")) %>%
  right_join(., FHDfByRegion, by = c("country", "iso2c", "date")) 
regimeTypeDf <- tbl_df(regimeTypeDf)
head(regimeTypeDf)
str(regimeTypeDf)

```

```{r echo=FALSE, warning=FALSE, include=TRUE, fig.cap="Fig. 7 - Political Instability and Regime Type Indicators"}

# Scatterplot Matrix of Political Instability and Regime Type Indicators
pairs(~ stability + polityScore + democracyInst + autocracyInst + politicalRights +
        civilLiberties + FHcombinedScore, data=regimeTypeDf,
   main="")

```

```{r echo=FALSE, warning=FALSE, include=FALSE}
# Correlation Matrix between Political Stability and Regime Type Indicators
regimeTypeDf2 <- select(regimeTypeDf, stability, polityScore, democracyInst, autocracyInst, politicalRights,         civilLiberties, FHcombinedScore)
CorrelationRegimeTypeDf2 <- rcorr(as.matrix(regimeTypeDf2))


```



```{r echo=TRUE, warning=FALSE, include=TRUE}

#Table 6 - Correlation Matrix between Political Stability and Regime Type Indicators

CorrelationRegimeTypeDf2


```

### *Generalized Linear Regression Model to Identify the Significant Variables*

In this section, we include all variables in a single dataframe and run a step function in order to identify the most significant variables to be included in the prediction model.   

However, before runing the step function, we need to clean the data. The following steps were followed in order to remove the missing values (NAs):   

- first, we identify the variables with high percentage of missing values (more than 20%) and remove them from the dataframe,
- second, from the remaining variables and observations, we remove the incomplete cases and only use the complete ones.   


```{r echo=FALSE, warning=FALSE, include=FALSE}
#creating the main dataframe by joing the dataframes on governance, development and regime type, and selecting the variables that are highly correlated with political stability
library(dplyr)
WGIDevPolityDf <- left_join(WGIbyRegion, devIneqStabDf, by = c("country", "iso2c", "date")) %>%
  left_join(., regimeTypeDf, by = c("country", "iso2c", "date"))
WGIDevPolityDf <- tbl_df(WGIDevPolityDf)
head(WGIDevPolityDf)
str(WGIDevPolityDf)
names(WGIDevPolityDf)

# selecting the variables of interest in a new dataframe WGIDevPolityDf2:
WGIDevPolityDf2 <- select(WGIDevPolityDf, country, countryCode, iso2c, iso3c, region = region.x, subregion = subregion.x, date, stability, stabilityCategory, corruptionControl, governmentEffectiveness, regulatoryQuality, ruleOfLaw, voiceAndAccountability, GNIperCapita, HDI, GINI, polityScore, polityCategory, democracyInst, autocracyInst, politicalRights, civilLiberties, FHcombinedScore, FHstatus)
WGIDevPolityDf2$FHstatus <- as.factor(WGIDevPolityDf2$FHstatus)
WGIDevPolityDf2 <- tbl_df(WGIDevPolityDf2)
str(WGIDevPolityDf2)

#checking for missing values
colSums(is.na(WGIDevPolityDf2))

#removing the cases where stability score is missing
noStability <- filter(WGIDevPolityDf2, is.na(stability))
WGIDevPolityDf2 <- anti_join(WGIDevPolityDf2, noStability)

# removing columns with more that 20% of missing values
WGIDevPolityDf2 <- select(WGIDevPolityDf2, country, countryCode, iso2c, iso3c, region, subregion, date, stability, stabilityCategory, regulatoryQuality, GNIperCapita, politicalRights, civilLiberties, FHcombinedScore, FHstatus)

# using only complete cases (new dataframe = WGIDevPolityDf3)
WGIDevPolityDf3 <- WGIDevPolityDf2[complete.cases(WGIDevPolityDf2),]
dim(WGIDevPolityDf3)
colSums(is.na(WGIDevPolityDf3))
```

```{r echo=FALSE, include=FALSE}
# model including all variables with complete cases
WGIDevPolityDf3b <- select(WGIDevPolityDf3, region, subregion, stability, regulatoryQuality, GNIperCapita, politicalRights, civilLiberties, FHcombinedScore, FHstatus)

```

```{r echo=TRUE, include=TRUE}
# Table 7 - Summary of the Generalized Linear Regression Model Using Step Function
modelFit1 <- step(glm( data=WGIDevPolityDf3b, stability ~ .), trace=0,steps=10000) 
summary(modelFit1)
```

The above step function allows us the identify the following variables as the most significant predictors to be included in the prediction models: 
subregion, regulatoryQuality, GNIperCapita, civilLiberties, FHstatus.


## III. Predicting Political Stability Using Machine Learning



### *Predicting with Generalized Linear Regression*

Using the variables identified through the above step function, we run machine learning predictions using generalized linear regression with the caret package, and we obtain the following results:    

- As shown in Table 8a, on the trainning data set, the following variables are still significant: subregion, regulatoryQuality, GNIperCapita, civilLiberties, FHstatus.

- As shown in Table 8b, on the test data set, the same variables (subregion, regulatoryQuality, GNIperCapita, civilLiberties, FHstatus) are also significant.


```{r echo=FALSE, warning=FALSE, include=FALSE}

library(dplyr)
library(caret)
library(kernlab)
#selecting the variables for the model
WGIDevPolityDf4 <- select(WGIDevPolityDf3, stability, subregion, regulatoryQuality, GNIperCapita, civilLiberties, FHstatus)

# create train and test sets
set.seed(635)
inTrain1 <- createDataPartition(y=WGIDevPolityDf4$stability, p=0.75, list=FALSE)
train1 <- WGIDevPolityDf4[inTrain1,]
test1 <- WGIDevPolityDf4[-inTrain1,]

# build generalized linear regression model on training set
modelFit1 <- glm(stability ~ .,data=train1)
# print summary of modelFit1
# summary(modelFit1)

# build generalized linear regression model on test set
modelFit2 <- glm(stability ~ .,data=test1)
# print summary of modelFit2
# summary(modelFit2)

```


```{r echo=TRUE, warning=FALSE, include=TRUE}
#Table 8a - Machine Learning Prediction Using Generalized Linear Regression on the Trainning Dataset
summary(modelFit1)
```


```{r echo=TRUE, warning=FALSE, include=TRUE}
# Table 8b - Machine Learning Prediction Using Generalized Linear Regression on the Testing Dataset
summary(modelFit2)
```


### *Predicting with Classification Tree*

In this classification tree, we are using "stability category" as the target variable. Using the variables identified through the above step function, we run machine learning predictions using classification tree with the caret package, and we obtain the following results:    

- As shown in Figure 8, on the trainning data set, regulatoryQuality is the only variable that can predict either a case is "moderately unstable" (65%), "moderately stable" (22%), or "highly stable" (12%). 

- As shown in Figure 9, on the test data set, two variables, civilLiberties and regulatoryQuality, are needed to predict either a case is "moderately unstable" (60%), "moderately stable" (29%), or "highly stable" (11%).

In sum, in both models, only regulatoryQuality is the most consistent predictor of "stability category".

```{r echo=FALSE, warning=FALSE, include=FALSE}

library(dplyr)
library(caret)
library(kernlab)
library(rattle)

#selecting the variables for the model (new dataframe = WGIDevPolityDf4)
WGIDevPolityDf5 <- select(WGIDevPolityDf3, stabilityCategory, subregion, regulatoryQuality, GNIperCapita, civilLiberties, FHstatus)


# create test/train data sets
set.seed(123)
inTrain2 <- createDataPartition(y=WGIDevPolityDf5$stabilityCategory,p=0.75, list=FALSE)
train2 <- WGIDevPolityDf5[inTrain2,]
test2 <- WGIDevPolityDf5[-inTrain2,]
head(train2)

```



```{r echo=FALSE, warning=FALSE, include=TRUE, fig.cap="Fig. 8 - Classification Tree on the Trainning Data Set"}
# fit classification tree on the train data set
modFit3 <- train(stabilityCategory ~ .,method="rpart",data=train2)
# print the classification tree
print(modFit3$finalModel)

# plot the classification tree
fancyRpartPlot(modFit3$finalModel)


```


```{r echo=FALSE, warning=FALSE, include=TRUE, fig.cap= "Fig. 9 - Classification Tree on the Testing Data Set"}
# fit classification tree as on the train data set
modFit4 <- train(stabilityCategory ~ .,method="rpart",data=test2)
# print the classification tree
print(modFit4$finalModel)

# plot the classification tree
fancyRpartPlot(modFit4$finalModel)


```

