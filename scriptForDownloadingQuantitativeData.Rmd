---
title: "Collecting and Cleaning the Quantitative Data Used in this Project"
author: "Adrien Ratsimbaharison"
date: "9/19/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Downloading and Cleaning the Data on World Governance Indicators (WGI) from the World Bank Website Using `webstats`


```{r warning=FALSE}
library(wbstats)
library(readr)
library(lubridate)
library(dplyr)
library(Hmisc)
library(caret)
library(kernlab)
library(knitr)

# downloading the data on World Governance Indicators
#data on stability estimate
stabilityDf <- wb(country = "countries_only", indicator = "PV.EST", 
                          startdate = 1996, enddate = 2018, POSIXct = TRUE)
stabilityDf <- tbl_df(stabilityDf)
stabilityDf <- select(stabilityDf, country, iso2c, date, stability = value)
head(stabilityDf)


# creating a variable for stability category with dplyr
stabilityDf <- stabilityDf %>% mutate(stabilityCategory=cut(stability, breaks=c(-Inf, -1, 0, 1, Inf), labels=c("Highly Unstable","Moderately Unstable","Moderately Stable", "Highly Stable")))
head(stabilityDf)
str(stabilityDf)

#data on control of corruption estimate
corruptionControlDf <- wb(country = "countries_only", indicator = "GV.CONT.CO.ES", 
                          startdate = 1996, enddate = 2018, POSIXct = TRUE)
corruptionControlDf <- tbl_df(corruptionControlDf)
corruptionControlDf <- select(corruptionControlDf, country, iso2c, date, corruptionControl = value)
head(corruptionControlDf)


#data on government effectiveness estimate
governmentEffectivenessDf <- wb(country = "countries_only", indicator = "GV.GOVT.EF.ES", 
                          startdate = 1996, enddate = 2018, POSIXct = TRUE)
governmentEffectivenessDf <- tbl_df(governmentEffectivenessDf)
governmentEffectivenessDf <- select(governmentEffectivenessDf, country, iso2c, date, governmentEffectiveness = value)
head(governmentEffectivenessDf)

#data on regulatory quality estimate
regulatoryQualityDf <- wb(country = "countries_only", indicator = "RQ.EST", 
                          startdate = 1996, enddate = 2018, POSIXct = TRUE)
regulatoryQualityDf <- tbl_df(regulatoryQualityDf)
regulatoryQualityDf <- select(regulatoryQualityDf, country, iso2c, date, regulatoryQuality = value)
head(regulatoryQualityDf)

#data on rule of law estimate
ruleOfLawDf <- wb(country = "countries_only", indicator = "GV.RULE.LW.ES", 
                          startdate = 1996, enddate = 2018, POSIXct = TRUE)
ruleOfLawDf <- tbl_df(ruleOfLawDf)
ruleOfLawDf <- select(ruleOfLawDf, country, iso2c, date, ruleOfLaw = value)
head(ruleOfLawDf)

#data on voice and accountability estimate
voiceAndAccountabilityDf <- wb(country = "countries_only", indicator = "GV.VOIC.AC.ES", 
                          startdate = 1996, enddate = 2018, POSIXct = TRUE)
voiceAndAccountabilityDf <- tbl_df(voiceAndAccountabilityDf)
voiceAndAccountabilityDf <- select(voiceAndAccountabilityDf, country, iso2c, date, voiceAndAccountability = value)
head(voiceAndAccountabilityDf)

# joining the data on WGI
WGI <- full_join(stabilityDf, corruptionControlDf, by = c("country", "iso2c", "date")) %>%
  full_join(., governmentEffectivenessDf, by = c("country", "iso2c", "date")) %>%
  full_join(., regulatoryQualityDf, by = c("country", "iso2c", "date")) %>%
  full_join(., ruleOfLawDf, by = c("country", "iso2c", "date")) %>%
  full_join(., voiceAndAccountabilityDf, by = c("country", "iso2c", "date"))
WGI <- tbl_df(WGI)
head(WGI)

# downloading the data on country code with region and subregion from a github repository maintained by Lukes  
# at: https://github.com/lukes/ISO-3166-Countries-with-Regional-Codes/blob/master/all/all.csv
# According to the author and contributors, "These lists are the result of merging data from two sources, the Wikipedia ISO 3166-1 article for alpha and numeric country codes, and the UN Statistics site for countries' regional, and sub-regional codes. In addition to countries, it includes dependent territories."

regionSubregionDf <- read_csv("https://raw.githubusercontent.com/aratsimbaharison/ISO-3166-Countries-with-Regional-Codes/master/all/all.csv")
regionSubregionDf <- tbl_df(regionSubregionDf)
regionSubregionDf <- select(regionSubregionDf, country = name, iso2c = `alpha-2`, iso3c = `alpha-3`, 
                            countryCode = `country-code`, region, subregion = `sub-region`)
head(regionSubregionDf)                          

#joining the data on WGI with the UN classification by region and subregion
WGIbyCountryAndRegion <- full_join(WGI, regionSubregionDf, by = "iso2c")
WGIbyCountryAndRegion <- tbl_df(WGIbyCountryAndRegion)
WGIbyCountryAndRegion <- select(WGIbyCountryAndRegion, country = country.x, countryCode, iso2c, iso3c, date, stability, stabilityCategory, corruptionControl, governmentEffectiveness, regulatoryQuality, ruleOfLaw, voiceAndAccountability, region, subregion)

head(WGIbyCountryAndRegion)
names(WGIbyCountryAndRegion)
WGIbyCountryAndRegion <- select(WGIbyCountryAndRegion, country, countryCode, iso2c, iso3c, date, stability, stabilityCategory, corruptionControl, governmentEffectiveness, regulatoryQuality, ruleOfLaw, voiceAndAccountability, region, subregion)
names(WGIbyCountryAndRegion)

# # making the data on WGI available in the local repository
# WGIbyCountryAndRegion <- write.csv(WGIbyCountryAndRegion, "WGIbyCountryAndRegion.csv")
# WGIbyCountryAndRegion <- tbl_df(WGIbyCountryAndRegion)


```

## Downloading and Cleaning the Data on Development, Inequality, and Poverty from the World Bank Website Using `webstats`


```{r warning=FALSE}
library(wbstats)
library(readr)
library(lubridate)
library(dplyr)
library(Hmisc)
library(caret)
library(kernlab)
library(knitr)

#data on GNI per capita (constant 2010 US$) (NY.GNP.PCAP.KD)
GNIperCapitaDf <- wb(country = "countries_only", indicator = "NY.GNP.PCAP.KD", 
                     startdate = 1996, enddate = 2018, POSIXct = TRUE)
GNIperCapitaDf <- tbl_df(GNIperCapitaDf)
GNIperCapitaDf <- select(GNIperCapitaDf, country, iso2c, date, value)
GNIperCapitaDf <- rename(GNIperCapitaDf, GNIperCapita = value)
head(GNIperCapitaDf)

#data on human development index (UNDP.HDI.XD)
HDIDf <- wb(country = "countries_only", indicator = "UNDP.HDI.XD", 
            startdate = 1996, enddate = 2018, POSIXct = TRUE)
HDIDf <- tbl_df(HDIDf)
HDIDf <- select(HDIDf, country, iso2c, date, value)
HDIDf <- rename(HDIDf, HDI = value)
head(HDIDf)

#data on social inequality measured in terms of the World Bank's GINI index (SI.POV.GINI)
GINIDf <- wb(country = "countries_only", indicator = "SI.POV.GINI", 
            startdate = 1996, enddate = 2018, POSIXct = TRUE)
GINIDf <- tbl_df(GINIDf)
GINIDf <- select(GINIDf, country, iso2c, date, value)
GINIDf <- rename(GINIDf, GINI = value)
head(GINIDf)


# data on poverty measured in terms of the World Bank's Poverty headcount ratio at $1.90 a day (2011 PPP) (% of population) (SI.POV.DDAY)

povHeadCountDF <- wb(country = "countries_only", indicator = "SI.POV.DDAY", 
            startdate = 1996, enddate = 2018, POSIXct = TRUE)
povHeadCountDF <- tbl_df(povHeadCountDF)
povHeadCountDF <- select(povHeadCountDF, country, iso2c, date, value)
povHeadCountDF <- rename(povHeadCountDF, povertyHeadCount = value)
head(povHeadCountDF)

# joining the data on development, social inequality, and poverty: devIneqPovDF
devIneqPovDF <- full_join(GNIperCapitaDf, HDIDf, by = c("country", "iso2c", "date")) %>%
  full_join(., GINIDf, by = c("country", "iso2c", "date")) %>%
  full_join(., povHeadCountDF, by = c("country", "iso2c", "date"))
  
devIneqPovDF <- tbl_df(devIneqPovDF)
head(devIneqPovDF)
devIneqPovDF$date <- as.integer(devIneqPovDF$date)
names(devIneqPovDF)

# # making the data on development, social inequality and poverty available in the local repository
# devIneqPovDF <- write.csv(devIneqPovDF, "devIneqPovDF.csv")
# devIneqPovDF <- tbl_df(devIneqPovDF)


# joining the data on WGI, development, social inequality, and poverty
# (WGIdevIneqPovDF)
WGIbyCountryAndRegion <- read.csv("WGIbyCountryAndRegion.csv")
WGIdevIneqPovDF <- full_join(WGIbyCountryAndRegion, devIneqPovDF, by = c("country", "iso2c", "date"))
WGIdevIneqPovDF <- tbl_df(WGIdevIneqPovDF)
WGIdevIneqPovDF$date <- as.integer(WGIdevIneqPovDF$date)
head(WGIdevIneqPovDF)
names(WGIdevIneqPovDF)

# # making the data on WGI, development, social inequality and poverty (WGIdevIneqPovDF) available in the local repository
# WGIdevIneqPovDF <- write.csv(WGIdevIneqPovDF, "WGIdevIneqPovDF.csv")
# WGIdevIneqPovDF <- tbl_df(WGIdevIneqPovDF)
# 

```

## Downloading and Cleaning the Data on regime types from Freedom House, Polity IV and 

```{r warning= FALSE}

library(wbstats)
library(readr)
library(lubridate)
library(dplyr)
library(Hmisc)
library(caret)
library(kernlab)
library(knitr)

#data on political system, revised combined polity score (UPP.REV.POL.XQ) - see Polity IV
polityScoreDf <- wb(country = "countries_only", indicator = "UPP.REV.POL.XQ", 
                    startdate = 1996, enddate = 2018, POSIXct = TRUE)
polityScoreDf <- select(polityScoreDf, country, iso2c, date, value)
polityScoreDf <- rename(polityScoreDf, polityScore = value)
head(polityScoreDf)

# creating a new variable for polity category (polityCategory)
polityScoreDf <- polityScoreDf %>% mutate(polityCategory=cut(polityScore, breaks=c(-Inf, -6, 6, Inf), labels=c("Autocracy","Anocracy","Democracy")))
head(polityScoreDf)

#data on political system, Institutionalized democracy (UPP.INS.DEMO.XQ) - see Polity IV
democracyDf <- wb(indicator = "UPP.INS.DEMO.XQ", startdate = 1996, enddate = 2018, POSIXct = TRUE)
democracyDf <- select(democracyDf, country, iso2c, date, value)
democracyDf <- rename(democracyDf, democracyInst = value)
head(democracyDf)

#data on political system, Institutionalized autocracy (UPP.INS.AUTO.XQ) - see Polity IV
autocracyDf <- wb(country = "countries_only", indicator = "UPP.INS.AUTO.XQ", 
                  startdate = 1996, enddate = 2018, POSIXct = TRUE)
autocracyDf <- select(autocracyDf, country, iso2c, date, value)
autocracyDf <- rename(autocracyDf, autocracyInst = value)
head(autocracyDf)

# # downloadong the "Stata Friendly Freedom House Data, 1973-2018" on political right and civil liberty maintained by Amanda B. Edgell, University of Florida (homepage: https://acrowinghen.com/data/)
 
library(readxl)
url <- "https://acrowinghen.files.wordpress.com/2018/05/fh_rankings_1973_2018.xlsx"
destfile <- "fh_rankings_1973_2018.xlsx"
curl::curl_download(url, destfile)
fh_rankings_1973_2018 <- read_excel(destfile, sheet = 3)
freedomHouseDF <- read_excel("fh_rankings_1973_2018.xlsx", sheet = 3)
freedomHouseDF <- tbl_df(freedomHouseDF)
head(freedomHouseDF)

freedomHouseDF <- select(freedomHouseDF, country, year, pr, cl, mean, status, inverse_pr, inverse_cl, inverse_mean)

freedomHouseDF <- filter(freedomHouseDF, year>= 1996)
freedomHouseDF <- rename(freedomHouseDF, date = year)
freedomHouseDF$date <- as.character(freedomHouseDF$date)
head(freedomHouseDF)

# joining the Freedom House data with the data on region and subregion with iso2c

freedomHouseByRegionDF <- left_join(freedomHouseDF, regionSubregionDf, by = "country")
freedomHouseByRegionDF <- tbl_df(freedomHouseByRegionDF)
freedomHouseByRegionDF <- select(freedomHouseByRegionDF, country, iso2c, date, politicalRights = inverse_pr,
                       civilLiberties = inverse_cl, FHcombinedScore = inverse_mean, FHstatus = status,
                       region, subregion)
head(freedomHouseByRegionDF)
str(freedomHouseByRegionDF)

# #joining the data on political stability and regime types indicators (regimeTypeDf)
# regimeTypeDf <- full_join(stabilityDf, polityScoreDf, by = c("country", "iso2c", "date")) %>%
#   full_join(., democracyDf, by = c("country", "iso2c", "date")) %>%
#   full_join(., autocracyDf, by = c("country", "iso2c", "date")) %>%
#   right_join(., FHDfByRegion, by = c("country", "iso2c", "date")) 
# regimeTypeDf <- tbl_df(regimeTypeDf)
# head(regimeTypeDf)
# str(regimeTypeDf)

```



