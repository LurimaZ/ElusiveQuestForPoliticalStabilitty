---
title: "Script for Downloading the Quantitative Data"
author: "Adrien Ratsimbaharison"
date: "9/19/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Downloading and Cleaning the Data on World Governance Indicators (WGI) from the World Bank Website Using `webstats`


```{r echo=FALSE, warning=FALSE, include=FALSE}
library(wbstats)
library(readr)
library(lubridate)
library(dplyr)
library(Hmisc)
library(caret)
library(kernlab)
library(knitr)

# downloading the data on World Governance Indicators
#data on stability estimate
stabilityDf <- wb(country = "countries_only", indicator = "PV.EST", 
                          startdate = 1996, enddate = 2018, POSIXct = TRUE)
stabilityDf <- tbl_df(stabilityDf)
stabilityDf <- select(stabilityDf, country, iso2c, date, stability = value)
head(stabilityDf)


# creating a variable for stability category with dplyr
stabilityDf <- stabilityDf %>% mutate(stabilityCategory=cut(stability, breaks=c(-Inf, -1, 0, 1, Inf), labels=c("Highly Unstable","Moderately Unstable","Moderately Stable", "Highly Stable")))
head(stabilityDf)
str(stabilityDf)

#data on control of corruption estimate
corruptionControlDf <- wb(country = "countries_only", indicator = "GV.CONT.CO.ES", 
                          startdate = 1996, enddate = 2018, POSIXct = TRUE)
corruptionControlDf <- tbl_df(corruptionControlDf)
corruptionControlDf <- select(corruptionControlDf, country, iso2c, date, corruptionControl = value)
head(corruptionControlDf)


#data on government effectiveness estimate
governmentEffectivenessDf <- wb(country = "countries_only", indicator = "GV.GOVT.EF.ES", 
                          startdate = 1996, enddate = 2018, POSIXct = TRUE)
governmentEffectivenessDf <- tbl_df(governmentEffectivenessDf)
governmentEffectivenessDf <- select(governmentEffectivenessDf, country, iso2c, date, governmentEffectiveness = value)
head(governmentEffectivenessDf)

#data on regulatory quality estimate
regulatoryQualityDf <- wb(country = "countries_only", indicator = "RQ.EST", 
                          startdate = 1996, enddate = 2018, POSIXct = TRUE)
regulatoryQualityDf <- tbl_df(regulatoryQualityDf)
regulatoryQualityDf <- select(regulatoryQualityDf, country, iso2c, date, regulatoryQuality = value)
head(regulatoryQualityDf)

#data on rule of law estimate
ruleOfLawDf <- wb(country = "countries_only", indicator = "GV.RULE.LW.ES", 
                          startdate = 1996, enddate = 2018, POSIXct = TRUE)
ruleOfLawDf <- tbl_df(ruleOfLawDf)
ruleOfLawDf <- select(ruleOfLawDf, country, iso2c, date, ruleOfLaw = value)
head(ruleOfLawDf)

#data on voice and accountability estimate
voiceAndAccountabilityDf <- wb(country = "countries_only", indicator = "GV.VOIC.AC.ES", 
                          startdate = 1996, enddate = 2018, POSIXct = TRUE)
voiceAndAccountabilityDf <- tbl_df(voiceAndAccountabilityDf)
voiceAndAccountabilityDf <- select(voiceAndAccountabilityDf, country, iso2c, date, voiceAndAccountability = value)
head(voiceAndAccountabilityDf)

# joining the data on WGI
WGI <- full_join(stabilityDf, corruptionControlDf, by = c("country", "iso2c", "date")) %>%
  full_join(., governmentEffectivenessDf, by = c("country", "iso2c", "date")) %>%
  full_join(., regulatoryQualityDf, by = c("country", "iso2c", "date")) %>%
  full_join(., ruleOfLawDf, by = c("country", "iso2c", "date")) %>%
  full_join(., voiceAndAccountabilityDf, by = c("country", "iso2c", "date"))
WGI <- tbl_df(WGI)
head(WGI)

# downloading the data on country code with region and subregion from a github repository maintained by Lukes  
# at: https://github.com/lukes/ISO-3166-Countries-with-Regional-Codes/blob/master/all/all.csv

regionSubregionDf <- read_csv("https://raw.githubusercontent.com/aratsimbaharison/ISO-3166-Countries-with-Regional-Codes/master/all/all.csv")
regionSubregionDf <- tbl_df(regionSubregionDf)
regionSubregionDf <- select(regionSubregionDf, country = name, iso2c = `alpha-2`, iso3c = `alpha-3`, 
                            countryCode = `country-code`, region, subregion = `sub-region`)
head(regionSubregionDf)                           

# merging WGI with UN classification by region and subregion
WGIbyRegion <- merge(WGI, regionSubregionDf, by = "iso2c")
WGIbyRegion <- tbl_df(WGIbyRegion)
WGIbyRegion <- select(WGIbyRegion, country = country.x, countryCode, iso2c, iso3c, date, stability, stabilityCategory, corruptionControl, governmentEffectiveness, regulatoryQuality, ruleOfLaw, voiceAndAccountability, region, subregion)
head(WGIbyRegion)

```

